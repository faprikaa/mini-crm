generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String          @id @default(cuid())
  name                    String          
  email                   String          @unique
  password                String
  role                    Role            @default(ADMIN)
  generatedPromoIdeaWeeks PromoIdeaWeek[] @relation("UserGeneratedPromoIdeaWeeks")
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
}

model Customer {
  id                 String   @id @default(cuid())
  name               String   @unique
  email              String?  
  phone              String?  
  favoriteProduct    Product? @relation("CustomerFavoriteProduct", fields: [favoriteProductId], references: [id])
  favoriteProductId  String?
  tags               Tag[]    @relation("CustomerTags")
  sales              Sale[]   @relation("CustomerSales")
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Tag {
  id         String      @id @default(cuid())
  name       String      @unique
  customers  Customer[]  @relation("CustomerTags")
  promoIdeas PromoIdea[] @relation("PromoIdeaTags")
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
}

model Product {
  id          String      @id @default(cuid())
  name        String      @unique
  price       Int
  category    String?
  description String?
  favoritedBy Customer[]  @relation("CustomerFavoriteProduct")
  sales       Sale[]      @relation("ProductSales")
  promoIdeas  PromoIdea[] @relation("PromoIdeaProducts")
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Sale {
  id         String   @id @default(cuid())
  product    Product  @relation("ProductSales", fields: [productId], references: [id])
  productId  String
  customer   Customer? @relation("CustomerSales", fields: [customerId], references: [id])
  customerId String?
  quantity   Int
  totalPrice Int
  soldAt     DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model PromoIdeaWeek {
  id              String      @id @default(cuid())
  weekStart       DateTime    @unique
  lastGeneratedAt DateTime
  generatedById   String?
  generatedModel  String?
  generatedBy     User?       @relation("UserGeneratedPromoIdeaWeeks", fields: [generatedById], references: [id], onDelete: SetNull)
  ideas           PromoIdea[] @relation("PromoWeekIdeas")
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([generatedById])
}

model PromoIdea {
  id          String        @id @default(cuid())
  promoWeek   PromoIdeaWeek @relation("PromoWeekIdeas", fields: [promoWeekId], references: [id], onDelete: Cascade)
  promoWeekId String
  theme       String
  segment     String
  whyNow      String
  message     String
  bestTime    String?
  tags        Tag[]          @relation("PromoIdeaTags")
  products    Product[]      @relation("PromoIdeaProducts")
  createdAt   DateTime      @default(now())

  @@index([promoWeekId])
}

enum Role {
  ADMIN
  SUPER_ADMIN
}
