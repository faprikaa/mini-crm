generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String          @id @default(cuid())
  name                    String
  email                   String          @unique
  password                String
  role                    Role            @default(ADMIN)
  generatedPromoIdeaWeeks PromoIdeaWeek[]
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
}

model Customer {
  id                 String   @id @default(cuid())
  name               String
  email              String?
  phone              String?
  favoriteProduct    Product? @relation(fields: [favoriteProductId], references: [id])
  favoriteProductId  String?
  tags               Tag[]
  sales              Sale[]
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Tag {
  id         String      @id @default(cuid())
  name       String      @unique
  customers  Customer[]
  promoIdeas PromoIdea[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
}

model Product {
  id          String      @id @default(cuid())
  name        String
  price       Int
  category    String?
  description String?
  favoritedBy Customer[]
  sales       Sale[]
  promoIdeas  PromoIdea[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Sale {
  id         String   @id @default(cuid())
  product    Product  @relation(fields: [productId], references: [id])
  productId  String
  customer   Customer? @relation(fields: [customerId], references: [id])
  customerId String?
  quantity   Int
  totalPrice Int
  soldAt     DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model PromoIdeaWeek {
  id              String      @id @default(cuid())
  weekStart       DateTime    @unique
  lastGeneratedAt DateTime
  generatedById   String?
  generatedBy     User?       @relation(fields: [generatedById], references: [id], onDelete: SetNull)
  ideas           PromoIdea[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([generatedById])
}

model PromoIdea {
  id          String        @id @default(cuid())
  promoWeek   PromoIdeaWeek @relation(fields: [promoWeekId], references: [id], onDelete: Cascade)
  promoWeekId String
  theme       String
  segment     String
  whyNow      String
  message     String
  bestTime    String?
  tags        Tag[]
  products    Product[]
  createdAt   DateTime      @default(now())

  @@index([promoWeekId])
}

enum Role {
  ADMIN
  SUPER_ADMIN
}
