generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String          @id @default(cuid())
  name                    String          
  email                   String          @unique
  password                String
  generatedPromoIdeaWeeks PromoIdeaWeek[] @relation("UserGeneratedPromoIdeaWeeks")
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
}

model Customer {
  id                 String        @id @default(cuid())
  name               String        @unique
  email              String?  
  phone              String?  
  favoriteProduct    Product?      @relation("CustomerFavoriteProduct", fields: [favoriteProductId], references: [id])
  favoriteProductId  String?
  customerTags       CustomerTag[]
  sales              Sale[]        @relation("CustomerSales")
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

model Tag {
  id             String           @id @default(cuid())
  name           String           @unique
  customerTags   CustomerTag[]
  promoIdeaTags  PromoIdeaTag[]
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
}

model Product {
  id               String             @id @default(cuid())
  name             String             @unique
  price            Int
  category         String?
  description      String?
  favoritedBy      Customer[]         @relation("CustomerFavoriteProduct")
  sales            Sale[]             @relation("ProductSales")
  promoIdeaProducts PromoIdeaProduct[]
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
}

model Sale {
  id         String   @id @default(cuid())
  product    Product  @relation("ProductSales", fields: [productId], references: [id])
  productId  String
  customer   Customer? @relation("CustomerSales", fields: [customerId], references: [id])
  customerId String?
  quantity   Int
  totalPrice Int
  soldAt     DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model PromoIdeaWeek {
  id              String      @id @default(cuid())
  weekStart       DateTime
  lastGeneratedAt DateTime
  generatedById   String?
  generatedModel  String?
  generatedBy     User?       @relation("UserGeneratedPromoIdeaWeeks", fields: [generatedById], references: [id], onDelete: SetNull)
  ideas           PromoIdea[] @relation("PromoWeekIdeas")
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([generatedById])
}

model PromoIdea {
  id               String             @id @default(cuid())
  promoWeek        PromoIdeaWeek      @relation("PromoWeekIdeas", fields: [promoWeekId], references: [id], onDelete: Cascade)
  promoWeekId      String
  theme            String
  segment          String
  whyNow           String
  message          String
  bestTime         String?
  promoIdeaTags    PromoIdeaTag[]
  promoIdeaProducts PromoIdeaProduct[]
  createdAt        DateTime           @default(now())

  @@index([promoWeekId])
}

model CustomerTag {
  customerId String
  tagId      String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([customerId, tagId])
}

model PromoIdeaTag {
  promoIdeaId String
  tagId       String
  promoIdea   PromoIdea @relation(fields: [promoIdeaId], references: [id], onDelete: Cascade)
  tag         Tag       @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([promoIdeaId, tagId])
}

model PromoIdeaProduct {
  promoIdeaId String
  productId   String
  promoIdea   PromoIdea @relation(fields: [promoIdeaId], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([promoIdeaId, productId])
}
